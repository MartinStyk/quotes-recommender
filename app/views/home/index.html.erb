<%= link_to 'Generate a random quote!', root_path, class: 'btn btn-outline-info' %>

<p></p>

<div class="card">
  <div class="card-header">
    <%= @quote.categories.map {|cat| cat.name}.join(', ') if @quote %>
  </div>
  <div class="card-body">
    <blockquote class="blockquote mb-0">
      <p><%= @quote.text if @quote %></p>
      <footer class="blockquote-footer">
        <cite title="Source Title"><%= @quote.author if @quote %></cite>
      </footer>
      <p>
        <div id="user_star"></div>
      </p>
    </blockquote>
  </div>
</div>

<p></p>

<!-- example form for rating -->
<% if @rating.persisted? %>
  <%= form_with(model: @rating, local: true) do |form| %>
    <% if @rating.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@rating.errors.count, "error") %> prohibited this rating from being saved:</h2>

          <ul>
            <% @rating.errors.full_messages.each do |message| %>
                <li><%= message %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div class="field">
      <%= form.label :rating %>
      <%= form.select :user_rating, [1,2,3,4,5].collect { |n| [n, n] } %>
    </div>

    <div class="actions">
      <%= form.submit %>
    </div>
  <% end %>
<% end %>


<script>
    $('#user_star').raty({
        path: '/assets',
        click: function (user_rating, evt) {
            $.ajax({
                url: '/ratings/' + <%= @quote.id %>,
                type: 'PATCH',
                data: {user_rating: user_rating }
            });
            alert('ID: ' + this.id +
                "\nscore: " + user_rating +
                "\nevent: " + evt +
                "\nquote id: " + <%= @quote.id %> +
                "\n");
        }
    });
</script>
